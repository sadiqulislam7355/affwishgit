/*
  # Add Default Users for Production

  1. Default Users
    - Admin user with full access
    - Affiliate user for testing
    - Proper password hashing and setup

  2. Sample Data
    - Default offers for testing
    - Settings configuration
    - Affiliate records

  3. Security
    - Proper RLS policies
    - Secure default passwords
*/

-- Insert default admin user
INSERT INTO auth.users (
  id,
  instance_id,
  email,
  encrypted_password,
  email_confirmed_at,
  created_at,
  updated_at,
  role,
  aud,
  confirmation_token,
  email_change_token_new,
  recovery_token
) VALUES (
  '00000000-0000-0000-0000-000000000001',
  '00000000-0000-0000-0000-000000000000',
  'admin@affwish.com',
  crypt('Admin123!@#', gen_salt('bf')),
  now(),
  now(),
  now(),
  'authenticated',
  'authenticated',
  '',
  '',
  ''
) ON CONFLICT (id) DO NOTHING;

-- Insert default affiliate user
INSERT INTO auth.users (
  id,
  instance_id,
  email,
  encrypted_password,
  email_confirmed_at,
  created_at,
  updated_at,
  role,
  aud,
  confirmation_token,
  email_change_token_new,
  recovery_token
) VALUES (
  '00000000-0000-0000-0000-000000000002',
  '00000000-0000-0000-0000-000000000000',
  'affiliate@affwish.com',
  crypt('Affiliate123!@#', gen_salt('bf')),
  now(),
  now(),
  now(),
  'authenticated',
  'authenticated',
  '',
  '',
  ''
) ON CONFLICT (id) DO NOTHING;

-- Insert admin profile
INSERT INTO profiles (
  id,
  email,
  full_name,
  role,
  status,
  company,
  website,
  phone,
  country,
  address,
  city,
  zip_code,
  timezone,
  payment_method,
  payment_details,
  traffic_sources,
  experience_level,
  bio,
  email_verified,
  created_at,
  updated_at
) VALUES (
  '00000000-0000-0000-0000-000000000001',
  'admin@affwish.com',
  'AFFWISH Administrator',
  'admin',
  'active',
  'AFFWISH Network',
  'https://affwish.com',
  '+1-555-0100',
  'United States',
  '123 Network Street',
  'San Francisco',
  '94105',
  'America/Los_Angeles',
  'bank',
  '{"bank_name": "Chase Bank", "account_number": "****1234", "routing_number": "****5678"}',
  '{"Email Marketing", "PPC", "Social Media"}',
  'expert',
  'Network administrator with 10+ years experience in affiliate marketing.',
  true,
  now(),
  now()
) ON CONFLICT (id) DO NOTHING;

-- Insert affiliate profile
INSERT INTO profiles (
  id,
  email,
  full_name,
  role,
  status,
  company,
  website,
  phone,
  country,
  address,
  city,
  zip_code,
  timezone,
  payment_method,
  payment_details,
  traffic_sources,
  experience_level,
  bio,
  email_verified,
  created_at,
  updated_at
) VALUES (
  '00000000-0000-0000-0000-000000000002',
  'affiliate@affwish.com',
  'Top Affiliate Marketer',
  'affiliate',
  'active',
  'Marketing Pro LLC',
  'https://marketingpro.com',
  '+1-555-0200',
  'United States',
  '456 Marketing Avenue',
  'New York',
  '10001',
  'America/New_York',
  'paypal',
  '{"paypal_email": "affiliate@affwish.com"}',
  '{"Social Media", "Email Marketing", "SEO", "YouTube"}',
  'advanced',
  'Experienced affiliate marketer specializing in performance marketing and lead generation.',
  true,
  now(),
  now()
) ON CONFLICT (id) DO NOTHING;

-- Insert affiliate record
INSERT INTO affiliates (
  id,
  user_id,
  affiliate_id,
  manager_id,
  notes,
  tags,
  total_earnings,
  total_clicks,
  total_conversions,
  conversion_rate,
  epc,
  last_activity,
  created_at,
  updated_at
) VALUES (
  '00000000-0000-0000-0000-000000000003',
  '00000000-0000-0000-0000-000000000002',
  'AFF000001',
  '00000000-0000-0000-0000-000000000001',
  'Top performing affiliate - VIP status',
  '{"VIP", "High Volume", "Trusted"}',
  15420.50,
  45230,
  1240,
  2.74,
  0.34,
  now(),
  now(),
  now()
) ON CONFLICT (id) DO NOTHING;

-- Insert sample offers
INSERT INTO offers (
  id,
  name,
  description,
  advertiser,
  advertiser_id,
  payout,
  payout_type,
  rev_share_percentage,
  category,
  status,
  countries,
  devices,
  traffic_sources,
  offer_url,
  preview_url,
  tracking_url,
  postback_url,
  global_postback_enabled,
  caps,
  restrictions,
  conversion_flow,
  expires_at,
  require_approval,
  scrub_rate,
  throttle_rate,
  auto_approve,
  hold_period,
  created_by,
  created_at,
  updated_at
) VALUES 
(
  '00000000-0000-0000-0000-000000000010',
  'Premium Dating App - iOS/Android',
  'High-converting dating app with premium features. Target audience: 18-45 years old, looking for serious relationships.',
  'Dating Corp International',
  'DC_001',
  25.00,
  'CPA',
  null,
  'Dating',
  'active',
  '{"US", "CA", "UK", "AU", "DE"}',
  '{"Mobile", "Desktop"}',
  '{"Social Media", "Email Marketing", "Native Ads", "Push Notifications"}',
  'https://dating-app.example.com/signup',
  'https://dating-app.example.com/preview',
  'https://track.affwish.com/click?offer_id={offer_id}&affiliate_id={affiliate_id}&click_id={click_id}&sub1={sub1}&sub2={sub2}',
  'https://dating-app.example.com/postback?click_id={click_id}&status={status}&payout={payout}',
  true,
  '{"daily": 100, "weekly": 500, "monthly": 2000}',
  'No adult content, no incentivized traffic, 18+ only',
  'Registration + Email Verification + Profile Completion',
  null,
  false,
  5.0,
  0.0,
  true,
  7,
  '00000000-0000-0000-0000-000000000001',
  now(),
  now()
),
(
  '00000000-0000-0000-0000-000000000011',
  'Crypto Trading Platform',
  'Leading cryptocurrency trading platform with advanced features. High payouts for qualified leads.',
  'CryptoTrade Exchange',
  'CTE_002',
  40.00,
  'CPA',
  null,
  'Finance',
  'active',
  '{"US", "CA", "UK", "AU", "DE", "NL", "FR"}',
  '{"Desktop", "Mobile"}',
  '{"PPC", "Social Media", "Email Marketing", "Content Marketing"}',
  'https://crypto-exchange.example.com/register',
  'https://crypto-exchange.example.com/preview',
  'https://track.affwish.com/click?offer_id={offer_id}&affiliate_id={affiliate_id}&click_id={click_id}&source={source}',
  'https://crypto-exchange.example.com/conversion?click_id={click_id}&amount={payout}&status={status}',
  true,
  '{"daily": 50, "weekly": 300, "monthly": 1200}',
  'No crypto-related content restrictions, 18+ only, KYC required',
  'Registration + Email Verification + KYC + First Deposit',
  null,
  true,
  8.0,
  5.0,
  false,
  14,
  '00000000-0000-0000-0000-000000000001',
  now(),
  now()
),
(
  '00000000-0000-0000-0000-000000000012',
  'VPN Service - Premium Subscription',
  'Top-rated VPN service with global servers. High conversion rates on free trial offers.',
  'SecureVPN Solutions',
  'SVS_003',
  15.00,
  'CPA',
  null,
  'Software',
  'active',
  '{"Global"}',
  '{"Desktop", "Mobile", "Tablet"}',
  '{"SEO", "Content Marketing", "Social Media", "YouTube", "Review Sites"}',
  'https://secure-vpn.example.com/trial',
  'https://secure-vpn.example.com/preview',
  'https://track.affwish.com/click?offer_id={offer_id}&affiliate_id={affiliate_id}&click_id={click_id}&campaign={campaign}',
  'https://secure-vpn.example.com/postback?transaction_id={click_id}&commission={payout}&status={status}',
  true,
  '{"daily": 200, "weekly": 1000, "monthly": 4000}',
  'No trademark bidding, no adult content',
  'Free Trial Signup + Email Verification',
  null,
  false,
  3.0,
  0.0,
  true,
  3,
  '00000000-0000-0000-0000-000000000001',
  now(),
  now()
),
(
  '00000000-0000-0000-0000-000000000013',
  'Online Casino - Welcome Bonus',
  'Premium online casino with generous welcome bonuses. High-value players.',
  'Royal Casino Group',
  'RCG_004',
  50.00,
  'CPA',
  null,
  'Gaming',
  'active',
  '{"US", "CA", "UK", "AU", "NZ"}',
  '{"Desktop", "Mobile"}',
  '{"PPC", "Social Media", "Email Marketing", "Affiliate Sites"}',
  'https://royal-casino.example.com/welcome',
  'https://royal-casino.example.com/preview',
  'https://track.affwish.com/click?offer_id={offer_id}&affiliate_id={affiliate_id}&click_id={click_id}&btag={btag}',
  'https://royal-casino.example.com/affiliate/postback?player_id={click_id}&commission={payout}&status={status}',
  true,
  '{"daily": 25, "weekly": 150, "monthly": 600}',
  'No underage targeting, responsible gambling required, 21+ only',
  'Registration + Age Verification + First Deposit ($50 minimum)',
  null,
  true,
  12.0,
  10.0,
  false,
  21,
  '00000000-0000-0000-0000-000000000001',
  now(),
  now()
);

-- Update default settings with production values
UPDATE settings SET value = '"AFFWISH - Premium CPA Network"' WHERE key = 'network_name';
UPDATE settings SET value = '"The leading CPA affiliate network with premium offers and real-time tracking"' WHERE key = 'network_description';
UPDATE settings SET value = '"https://postback.affwish.com/global?click_id={click_id}&conversion_id={conversion_id}&offer_id={offer_id}&affiliate_id={affiliate_id}&payout={payout}&status={status}&timestamp={timestamp}&ip={ip_address}&country={country}"' WHERE key = 'global_postback_url';

-- Insert additional production settings
INSERT INTO settings (key, value, description, category, created_by) VALUES
('smtp_enabled', 'true', 'Enable SMTP email sending', 'email', '00000000-0000-0000-0000-000000000001'),
('email_verification_required', 'true', 'Require email verification for new signups', 'auth', '00000000-0000-0000-0000-000000000001'),
('auto_approve_affiliates', 'false', 'Automatically approve new affiliate registrations', 'auth', '00000000-0000-0000-0000-000000000001'),
('min_payout_amount', '50', 'Minimum payout amount in USD', 'payments', '00000000-0000-0000-0000-000000000001'),
('payment_frequency', '"weekly"', 'Default payment frequency', 'payments', '00000000-0000-0000-0000-000000000001'),
('tracking_domain', '"track.affwish.com"', 'Primary tracking domain', 'tracking', '00000000-0000-0000-0000-000000000001'),
('postback_domain', '"postback.affwish.com"', 'Primary postback domain', 'tracking', '00000000-0000-0000-0000-000000000001'),
('fraud_protection_threshold', '75', 'Fraud score threshold for blocking', 'fraud', '00000000-0000-0000-0000-000000000001'),
('click_deduplication_window', '24', 'Click deduplication window in hours', 'tracking', '00000000-0000-0000-0000-000000000001'),
('conversion_attribution_window', '30', 'Conversion attribution window in days', 'tracking', '00000000-0000-0000-0000-000000000001')
ON CONFLICT (key) DO UPDATE SET 
  value = EXCLUDED.value,
  updated_at = now();

-- Insert sample postback configurations
INSERT INTO postbacks (
  id,
  name,
  url,
  method,
  parameters,
  headers,
  status,
  offer_id,
  created_by,
  fire_count,
  last_fired,
  created_at,
  updated_at
) VALUES 
(
  '00000000-0000-0000-0000-000000000020',
  'Dating App Conversion Postback',
  'https://dating-app.example.com/postback',
  'GET',
  '{"click_id": "{click_id}", "status": "{status}", "payout": "{payout}", "offer_id": "{offer_id}", "affiliate_id": "{affiliate_id}"}',
  '{"User-Agent": "AFFWISH-Network/1.0", "Authorization": "Bearer dating_app_token_123"}',
  'active',
  '00000000-0000-0000-0000-000000000010',
  '00000000-0000-0000-0000-000000000001',
  0,
  null,
  now(),
  now()
),
(
  '00000000-0000-0000-0000-000000000021',
  'Crypto Exchange Postback',
  'https://crypto-exchange.example.com/conversion',
  'POST',
  '{"transaction_id": "{click_id}", "amount": "{payout}", "status": "{status}", "currency": "USD", "timestamp": "{timestamp}"}',
  '{"Content-Type": "application/json", "X-API-Key": "crypto_api_key_456"}',
  'active',
  '00000000-0000-0000-0000-000000000011',
  '00000000-0000-0000-0000-000000000001',
  0,
  null,
  now(),
  now()
);

-- Insert sample click and conversion data for testing
INSERT INTO clicks (
  id,
  click_id,
  offer_id,
  affiliate_id,
  ip_address,
  user_agent,
  country,
  device,
  browser,
  os,
  referrer,
  landing_page,
  sub_id,
  sub_id_2,
  sub_id_3,
  sub_id_4,
  sub_id_5,
  fraud_score,
  is_fraud,
  is_converted,
  created_at
) VALUES 
(
  '00000000-0000-0000-0000-000000000030',
  'click_1704067200_abc123',
  '00000000-0000-0000-0000-000000000010',
  '00000000-0000-0000-0000-000000000002',
  '192.168.1.100',
  'Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15',
  'US',
  'Mobile',
  'Safari',
  'iOS',
  'https://facebook.com',
  'https://dating-app.example.com/landing',
  'fb_campaign_001',
  'ios_users',
  'dating_interest',
  null,
  null,
  25,
  false,
  true,
  now() - interval '2 days'
),
(
  '00000000-0000-0000-0000-000000000031',
  'click_1704067300_def456',
  '00000000-0000-0000-0000-000000000011',
  '00000000-0000-0000-0000-000000000002',
  '192.168.1.101',
  'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
  'US',
  'Desktop',
  'Chrome',
  'Windows',
  'https://google.com',
  'https://crypto-exchange.example.com/landing',
  'google_ads_crypto',
  'desktop_users',
  'finance_interest',
  null,
  null,
  15,
  false,
  true,
  now() - interval '1 day'
);

-- Insert sample conversions
INSERT INTO conversions (
  id,
  conversion_id,
  click_id,
  offer_id,
  affiliate_id,
  payout,
  revenue,
  status,
  conversion_value,
  currency,
  transaction_id,
  customer_id,
  ip_address,
  user_agent,
  postback_sent,
  postback_response,
  approved_at,
  approved_by,
  rejection_reason,
  created_at,
  updated_at
) VALUES 
(
  '00000000-0000-0000-0000-000000000040',
  'conv_1704067500_xyz789',
  '00000000-0000-0000-0000-000000000030',
  '00000000-0000-0000-0000-000000000010',
  '00000000-0000-0000-0000-000000000002',
  25.00,
  30.00,
  'approved',
  25.00,
  'USD',
  'dating_txn_123456',
  'user_dating_001',
  '192.168.1.100',
  'Mozilla/5.0 (iPhone; CPU iPhone OS 17_0 like Mac OS X) AppleWebKit/605.1.15',
  true,
  'HTTP/1.1 200 OK',
  now() - interval '1 day',
  '00000000-0000-0000-0000-000000000001',
  null,
  now() - interval '2 days',
  now() - interval '1 day'
),
(
  '00000000-0000-0000-0000-000000000041',
  'conv_1704067600_uvw012',
  '00000000-0000-0000-0000-000000000031',
  '00000000-0000-0000-0000-000000000011',
  '00000000-0000-0000-0000-000000000002',
  40.00,
  50.00,
  'approved',
  40.00,
  'USD',
  'crypto_txn_789012',
  'user_crypto_002',
  '192.168.1.101',
  'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
  true,
  'HTTP/1.1 200 OK',
  now(),
  '00000000-0000-0000-0000-000000000001',
  null,
  now() - interval '1 day',
  now()
);

-- Insert sample payment records
INSERT INTO payments (
  id,
  affiliate_id,
  amount,
  currency,
  payment_method,
  payment_details,
  status,
  reference_id,
  transaction_id,
  period_start,
  period_end,
  notes,
  processed_at,
  processed_by,
  created_at,
  updated_at
) VALUES 
(
  '00000000-0000-0000-0000-000000000050',
  '00000000-0000-0000-0000-000000000002',
  2450.00,
  'USD',
  'paypal',
  '{"paypal_email": "affiliate@affwish.com", "paypal_transaction_id": "PP123456789"}',
  'completed',
  'PAY_001_2024_01',
  'pp_txn_123456789',
  '2024-01-01',
  '2024-01-15',
  'Bi-weekly payment for period Jan 1-15, 2024',
  now() - interval '5 days',
  '00000000-0000-0000-0000-000000000001',
  now() - interval '7 days',
  now() - interval '5 days'
),
(
  '00000000-0000-0000-0000-000000000051',
  '00000000-0000-0000-0000-000000000002',
  3120.00,
  'USD',
  'paypal',
  '{"paypal_email": "affiliate@affwish.com", "paypal_transaction_id": "PP987654321"}',
  'completed',
  'PAY_002_2024_01',
  'pp_txn_987654321',
  '2024-01-16',
  '2024-01-31',
  'Bi-weekly payment for period Jan 16-31, 2024',
  now() - interval '2 days',
  '00000000-0000-0000-0000-000000000001',
  now() - interval '3 days',
  now() - interval '2 days'
);